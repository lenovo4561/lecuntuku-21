<template>
  <div class="page">
    <list class="list-container">
      <!-- 顶部 Header 区域 -->
      <list-item type="header" class="header-item">
        <div class="header-box">
          <image class="header-bg" src="/pkg_main/assets/img/bizhi-bg.png"></image>
        </div>
      </list-item>

      <!-- 切换按钮区域 -->
      <list-item type="tabs" class="tabs-item">
        <div class="tabs-box">
          <div class="{{currentTab === 0 ? 'tab-btn-active' : 'tab-btn'}}" onclick="switchTab(0)">
            <text class="{{currentTab === 0 ? 'tab-text-active' : 'tab-text'}}">热门推荐</text>
          </div>
          <div class="{{currentTab === 1 ? 'tab-btn-active' : 'tab-btn'}}" onclick="switchTab(1)">
            <text class="{{currentTab === 1 ? 'tab-text-active' : 'tab-text'}}">猜你喜欢</text>
          </div>
          <div class="{{currentTab === 2 ? 'tab-btn-active' : 'tab-btn'}}" onclick="switchTab(2)">
            <text class="{{currentTab === 2 ? 'tab-text-active' : 'tab-text'}}">创意壁纸</text>
          </div>
        </div>
      </list-item>

      <!-- 图片列表区域 -->
      <list-item type="wallpapers" class="wallpapers-item">
        <div class="wallpaper-grid">
          <div class="wallpaper-column">
            <div class="wallpaper-card" for="{{(index, item) in leftList}}" onclick="openDetail(item, index)">
               <image class="wallpaper-img" src="{{item.url}}"></image>
            </div>
          </div>
          <div class="wallpaper-column">
            <div class="wallpaper-card" for="{{(index, item) in rightList}}" onclick="openDetail(item, index)">
               <image class="wallpaper-img" src="{{item.url}}"></image>
            </div>
          </div>
        </div>
      </list-item>
    </list>
  </div>
</template>

<script>
import router from '@system.router'

export default {
  data: {
    currentTab: 0,
    leftList: [],
    rightList: []
  },
  onInit() {
    console.log('Bizhi page initialized')
    this.loadWallpapers()
  },
  onShow() {
    console.log('Bizhi page onShow')
  },
  loadWallpapers() {
    // 根据当前 tab 生成不同的壁纸 URL 列表
    const wallpaperList = []
    let baseUrl = ''
    
    // 根据 currentTab 选择不同的 URL 前缀
    if (this.currentTab === 0) {
      // 热门推荐
      baseUrl = 'https://cdn.shijinzhuang.com/quick/lecuntk/bz/rmtj/'
    } else if (this.currentTab === 1) {
      // 猜你喜欢
      baseUrl = 'https://cdn.shijinzhuang.com/quick/lecuntk/bz/cnxh/'
    } else if (this.currentTab === 2) {
      // 创意壁纸
      baseUrl = 'https://cdn.shijinzhuang.com/quick/lecuntk/bz/cybz/'
    }
    
    // 生成1-24的壁纸URL列表
    for (let i = 1; i <= 24; i++) {
      wallpaperList.push({
        url: `${baseUrl}${i}.jpg`,
        id: i
      })
    }
    
    // 分配到左右两列
    this.leftList = []
    this.rightList = []
    wallpaperList.forEach((item, index) => {
      if (index % 2 === 0) {
        this.leftList.push(item)
      } else {
        this.rightList.push(item)
      }
    })
  },
  switchTab(index) {
    this.currentTab = index;
    // 切换 tab 时重新加载壁纸数据
    this.loadWallpapers();
  },
  openDetail(item, index) {
    // 合并左右列表为完整列表
    const allList = []
    const maxLen = Math.max(this.leftList.length, this.rightList.length)
    for (let i = 0; i < maxLen; i++) {
      if (this.leftList[i]) allList.push(this.leftList[i])
      if (this.rightList[i]) allList.push(this.rightList[i])
    }
    
    // 找到点击的图片在完整列表中的索引
    const clickedIndex = allList.findIndex(function(listItem) {
      return listItem.id === item.id
    })
    
    router.push({
      uri: '/pkg_main/pages/Detail',
      params: {
        wallpaperData: JSON.stringify(allList),
        startindex: clickedIndex >= 0 ? clickedIndex : 0
      }
    })
  }
}
</script>

<style>
.page {
  flex-direction: column;
  width: 100%;
  height: 100%;
  background-color: #ffffff;
}

.list-container {
  flex: 1;
  width: 100%;
}

.header-item {
  width: 100%;
  margin-bottom: 20px;
}

.header-box {
  width: 100%;
  height: 127px; /* 根据UI调整高度 */
}

.header-bg {
  width: 100%;
  height: 100%;
  resize-mode: cover;
}

.tabs-item {
  width: 100%;
  padding-left: 5px;
  padding-right: 5px;
  margin-bottom: 10px;
  margin-top: -45px;
  position: relative;
  z-index: 10;
}

.tabs-box {
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
}

.tab-btn {
  background-color: #e6e0f0; /* 浅紫色背�?*/
  border-radius: 20px;
  padding: 8px 14px;
  justify-content: center;
  align-items: center;
  flex: 1;
  margin: 0 6px;
}

.tab-btn-active {
  background-color: #000000;
  border-radius: 20px;
  padding: 8px 14px;
  justify-content: center;
  align-items: center;
  flex: 1;
  margin: 0 6px;
}

.tab-text {
  font-size: 10px;
  color: #999999;
}

.tab-text-active {
  font-size: 10px;
  color: #ffffff;
  font-weight: bold;
}

.wallpapers-item {
  width: 100%;
}

.wallpaper-grid {
  flex-direction: row;
  justify-content: space-around;
  width: 100%;
  padding: 0 7px;
}

.wallpaper-column {
  flex-direction: column;
}

.wallpaper-card {
  width: 115px;
  height: 162px;
  border-radius: 6px;
  margin-bottom: 7px;
  background-color: #eeeeee;
  overflow: hidden;
}

.wallpaper-img {
  width: 100%;
  height: 100%;
}
</style>
